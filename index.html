<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæŠ å›¾ï¼ˆå¼ºå“¥Â·å›½å†…ä¸“ç”¨ç¨³å®šç‰ˆï¼‰</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: radial-gradient(circle at center, #1e3a5f 0%, #0f172a 70%, #020617 100%);
            color: #fff; margin: 0; padding: 40px 20px;
            min-height: 100vh; display: flex; flex-direction: column; align-items: center; box-sizing: border-box;
        }
        h1.main-title {
            font-size: 32px; margin-bottom: 60px; font-weight: 700;
            background: linear-gradient(to right, #fff, #00d4ff);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
        }
        .main-container { width: 100%; max-width: 900px; display: flex; flex-direction: column; align-items: center; padding-bottom: 100px; }
        
        /* æ ¸å¿ƒåœ†å½¢æ‹–æ‹½åŒº */
        .circle-drop-zone {
            position: relative; width: 480px; height: 480px;
            display: flex; justify-content: center; align-items: center; cursor: pointer;
            border-radius: 50%; transition: all 0.4s ease-out; margin: 50px;
            box-shadow: 0 0 0 25px rgba(31, 78, 121, 0.4), 0 0 0 50px rgba(31, 78, 121, 0.25), 0 0 0 80px rgba(31, 78, 121, 0.1); 
            background: rgba(30, 58, 95, 0.3);
            /* é»˜è®¤ä¸å¯ç‚¹å‡»ï¼Œç­‰å¼•æ“åŠ è½½å®Œ */
            pointer-events: none; opacity: 0.6; grayscale: 100%;
        }
        /* æ¿€æ´»çŠ¶æ€ */
        .circle-drop-zone.ready {
            pointer-events: auto; opacity: 1; grayscale: 0%;
            box-shadow: 0 0 0 25px rgba(0, 212, 255, 0.1), 0 0 0 50px rgba(0, 212, 255, 0.05);
        }

        .circle-drop-zone.ready:hover { transform: scale(1.03); box-shadow: 0 0 20px rgba(0, 212, 255, 0.5); }
        
        .dashed-ring { position: absolute; inset: 5px; border: 4px dashed #3b6991; border-radius: 50%; animation: spinSlow 24s linear infinite; }
        .circle-drop-zone.ready .dashed-ring { border-color: #00d4ff; }
        @keyframes spinSlow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        .inner-content {
            position: relative; width: 380px; height: 380px;
            background: linear-gradient(145deg, #243b55, #1a2a3a); border-radius: 50%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; pointer-events: none; z-index: 2;
        }
        .icon-folder { font-size: 80px; margin-bottom: 25px; color: #94a3b8; transition: 0.3s; }
        .circle-drop-zone.ready .icon-folder { color: #00d4ff; text-shadow: 0 0 15px rgba(0,212,255,0.5); }
        
        h3 { margin: 0 0 15px 0; font-size: 28px; font-weight: 600; color: #fff; }
        .sub-text { color: #94a3b8; font-size: 18px; margin: 0; }
        .highlight-link { color: #00d4ff; text-decoration: none; border-bottom: 1px dotted #00d4ff; pointer-events: auto; }

        .status-badge {
            margin-top: 20px; padding: 6px 12px; border-radius: 20px; font-size: 14px;
            background: #334155; color: #94a3b8; transition: 0.3s;
        }
        .ready .status-badge { background: #00d4ff; color: #000; font-weight: bold; box-shadow: 0 0 10px #00d4ff; }
        .error .status-badge { background: #ff4d4d; color: white; }

        .progress-box, .result-area, .error-msg { display: none; width: 100%; max-width: 500px; margin-top: 60px; }
        .progress-box { background: #1e293b; padding: 25px; border-radius: 16px; box-shadow: 0 4px 25px rgba(0,0,0,0.3); }
        .progress-bar-bg { width: 100%; height: 10px; background: #334155; border-radius: 5px; overflow: hidden; margin-top: 12px; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #00d4ff, #0066ff); width: 0%; transition: width 0.3s; box-shadow: 0 0 15px #00d4ff; }
        
        .result-area { width: 100%; gap: 30px; grid-template-columns: 1fr 1fr; background: #1e293b; padding: 40px; border-radius: 20px; }
        .img-box { background: #0f172a; padding: 20px; border-radius: 16px; text-align: center; border: 1px solid #334155; }
        img { max-width: 100%; max-height: 400px; object-fit: contain; border-radius: 12px; }
        .checkerboard { background-image: linear-gradient(45deg, #1a1a1a 25%, transparent 25%), linear-gradient(-45deg, #1a1a1a 25%, transparent 25%); background-size: 20px 20px; background-color: #2a2a2a; }
        
        .btn { background: linear-gradient(to right, #00d4ff, #0099ff); color: #0f172a; font-weight: 800; border: none; padding: 16px 32px; border-radius: 10px; cursor: pointer; margin-top: 35px; width: 100%; font-size: 18px; transition: 0.3s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 212, 255, 0.5); color: white; }
        
        .error-msg { color: #ff6b6b; background: rgba(255, 107, 107, 0.1); padding: 20px; border-radius: 12px; border: 1px solid #ff6b6b; text-align: left; }
    </style>
</head>
<body>

<h1 class="main-title">AIæŠ å›¾ï¼ˆå¼ºå“¥Â·ç¨³å®šç‰ˆï¼‰</h1>

<div class="main-container">
    <div class="circle-drop-zone" id="dropArea" onclick="document.getElementById('fileInput').click()">
        <div class="dashed-ring"></div>
        <div class="inner-content">
            <div class="icon-folder">ğŸ“</div>
            <h3 id="mainText">æ­£åœ¨è¿æ¥å¼•æ“...</h3>
            <p class="sub-text">è¯·ç¨å€™ï¼Œæ­£åœ¨ä»å›½å†…èŠ‚ç‚¹åŠ è½½ AI</p>
            <div class="status-badge" id="statusBadge">â³ åˆå§‹åŒ–ä¸­</div>
        </div>
        <input type="file" id="fileInput" accept="image/*" style="display:none" onchange="start(this.files[0])">
    </div>

    <div class="progress-box" id="progressBox">
        <div style="display:flex; justify-content:space-between; color:#94a3b8;">
            <span id="statusLabel">å‡†å¤‡ä¸­...</span>
            <span id="percentLabel">0%</span>
        </div>
        <div class="progress-bar-bg"><div class="progress-fill" id="progressFill"></div></div>
    </div>

    <div class="error-msg" id="errorBox"></div>

    <div class="result-area" id="resultArea">
        <div class="img-box"><h4>åŸå›¾</h4><img id="origImg"></div>
        <div class="img-box checkerboard"><h4>AI æŠ å›¾ç»“æœ</h4><img id="resImg"></div>
    </div>
    <button class="btn" id="dlBtn" onclick="dl()" style="display:none">ğŸ“¥ ä¸‹è½½æ— æŸ PNG</button>
</div>

<script 
    src="https://npm.elemecdn.com/@imgly/background-removal@1.0.4/dist/imgly-background-removal.min.js" 
    onload="onLibLoaded()" 
    onerror="onLibError()">
</script>

<script>
    // é…ç½®æ¨¡å‹æ•°æ®èµ°å›½å†…æº
    const DATA_URL = "https://npm.elemecdn.com/@imgly/background-removal-data@1.0.4/dist/";
    let isReady = false;

    // 1. åº“åŠ è½½æˆåŠŸçš„å›è°ƒ
    function onLibLoaded() {
        isReady = true;
        const dz = document.getElementById('dropArea');
        dz.classList.add('ready');
        document.getElementById('mainText').innerText = "æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œ";
        document.getElementById('statusBadge').innerText = "âš¡ AI å¼•æ“å·²å°±ç»ª";
        // é¢„çƒ­ä¸€ä¸‹
        console.log("Engine Loaded via Elemecdn");
    }

    // 2. åº“åŠ è½½å¤±è´¥çš„å›è°ƒ
    function onLibError() {
        const dz = document.getElementById('dropArea');
        dz.classList.add('error');
        document.getElementById('mainText').innerText = "åŠ è½½å¤±è´¥";
        document.getElementById('statusBadge').innerText = "âŒ ç½‘ç»œè¿æ¥é”™è¯¯";
        showError("æ— æ³•è¿æ¥åˆ°å›½å†…åŠ é€ŸèŠ‚ç‚¹ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œã€‚");
    }

    let pendingFile = null;

    // æ‹–æ‹½é€»è¾‘
    const dropArea = document.getElementById('dropArea');
    dropArea.addEventListener('dragover', e => { e.preventDefault(); if(isReady) dropArea.style.transform='scale(1.02)'; });
    dropArea.addEventListener('dragleave', e => { e.preventDefault(); dropArea.style.transform='scale(1)'; });
    dropArea.addEventListener('drop', e => { 
        e.preventDefault(); 
        dropArea.style.transform='scale(1)'; 
        if(!isReady) return; 
        if(e.dataTransfer.files[0]) start(e.dataTransfer.files[0]); 
    });

    function start(file) {
        if (!isReady) {
            alert("AI å¼•æ“å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨ç­‰...");
            return;
        }
        pendingFile = file;
        resetUI();
        document.getElementById('origImg').src = URL.createObjectURL(file);
        
        // å»¶è¿Ÿæ‰§è¡Œç¡®ä¿ UI æ¸²æŸ“
        setTimeout(() => runAI(), 100);
    }

    async function runAI() {
        updateProgress("æ­£åœ¨ä»å›½å†…èŠ‚ç‚¹è°ƒå–æ¨¡å‹...", 5);
        try {
            const blob = await imglyRemoveBackground(pendingFile, {
                publicPath: DATA_URL,
                // å…³é”®ï¼šä¸å¼ºåˆ¶ fetch modeï¼Œè®©æµè§ˆå™¨è‡ªåŠ¨é€‚é…
                progress: (key, cur, total) => {
                    const pct = Math.round((cur/total)*100);
                    if(key.includes('fetch')) updateProgress(`ä¸‹è½½æ¨¡å‹ç»„ä»¶: ${pct}%`, pct);
                    else updateProgress(`AI æ™ºèƒ½è®¡ç®—ä¸­: ${pct}%`, pct);
                }
            });
            const url = URL.createObjectURL(blob);
            document.getElementById('resImg').src = url;
            window.dlUrl = url;
            showResult();
        } catch (e) {
            console.error(e);
            showError(`å¤„ç†å¤±è´¥: ${e.message}`);
        }
    }

    function resetUI() {
        document.getElementById('errorBox').style.display='none';
        document.getElementById('resultArea').style.display='none';
        document.getElementById('dlBtn').style.display='none';
        document.getElementById('dropArea').style.display='none';
        document.getElementById('progressBox').style.display='block';
    }
    function updateProgress(txt, pct) {
        document.getElementById('statusLabel').innerText = txt;
        document.getElementById('percentLabel').innerText = pct + '%';
        document.getElementById('progressFill').style.width = pct + '%';
    }
    function showResult() {
        document.getElementById('progressBox').style.display='none';
        document.getElementById('resultArea').style.display='grid';
        document.getElementById('dlBtn').style.display='block';
    }
    function showError(msg) {
        document.getElementById('progressBox').style.display='none';
        document.getElementById('dropArea').style.display='flex';
        document.getElementById('errorBox').style.display='block';
        document.getElementById('errorBox').innerHTML = `<strong>âŒ å‡ºé”™äº†</strong><br>${msg}`;
    }
    function dl() {
        const a = document.createElement('a');
        a.href = window.dlUrl; a.download = 'æŠ å›¾ç»“æœ.png'; a.click();
    }
</script>
</body>
</html>
