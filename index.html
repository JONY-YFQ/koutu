<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæŠ å›¾ (Vercel ä¸“ç”¨æ ‡å‡†ç‰ˆ)</title>
    <script src="https://unpkg.com/@imgly/background-removal@1.0.4/dist/imgly-background-removal.min.js" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: sans-serif; background: #0f172a; color: white;
            display: flex; flex-direction: column; align-items: center; padding: 40px;
        }
        .container {
            border: 2px dashed #334155; padding: 40px; border-radius: 20px;
            text-align: center; background: #1e293b; width: 100%; max-width: 500px;
        }
        h1 { margin-bottom: 20px; color: #00d4ff; }
        
        /* è°ƒè¯•æ—¥å¿—æ¡† */
        #debug-log {
            width: 100%; max-width: 600px; height: 150px; 
            background: #000; color: #0f0; font-family: monospace; 
            padding: 10px; margin-top: 30px; border-radius: 8px; 
            overflow-y: scroll; font-size: 12px; text-align: left;
            border: 1px solid #333;
        }

        .btn {
            background: #00d4ff; color: #000; font-weight: bold; border: none;
            padding: 12px 24px; border-radius: 6px; cursor: pointer; margin-top: 15px;
            font-size: 16px;
        }
        .btn:disabled { background: #475569; cursor: not-allowed; color: #94a3b8; }
        
        img { max-width: 100%; border-radius: 8px; margin-top: 15px; border: 1px solid #475569; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸš€ AI æŠ å›¾ (Vercel ç‰ˆ)</h1>
        
        <div id="upload-box">
            <p>è¯·é€‰æ‹©å›¾ç‰‡ï¼š</p>
            <input type="file" id="fileInput" accept="image/*" disabled>
        </div>

        <p id="status" style="color: #fbbf24; margin-top: 20px;">ğŸ”„ æ­£åœ¨åˆå§‹åŒ–å¼•æ“...</p>
        
        <div id="result" style="display:none;">
            <img id="resImg">
            <br>
            <button class="btn" onclick="dl()">ä¸‹è½½å›¾ç‰‡</button>
        </div>
    </div>

    <div id="debug-log">>> ç³»ç»Ÿå¯åŠ¨...<br></div>

    <script>
        // è¾…åŠ©æ—¥å¿—å‡½æ•°
        function log(msg) {
            const box = document.getElementById('debug-log');
            const time = new Date().toLocaleTimeString();
            box.innerHTML += `[${time}] ${msg}<br>`;
            box.scrollTop = box.scrollHeight; // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
        }

        // 1. æ£€æŸ¥æ ¸å¿ƒåº“æ˜¯å¦åŠ è½½
        window.onload = function() {
            if (typeof imglyRemoveBackground === 'undefined') {
                log("âŒ é”™è¯¯ï¼šæ ¸å¿ƒåº“åŠ è½½å¤±è´¥ï¼");
                log("å¯èƒ½åŸå› ï¼šæ‚¨çš„ç½‘ç»œæ— æ³•è¿æ¥åˆ° unpkg.com");
                document.getElementById('status').innerText = "âŒ å¼•æ“åŠ è½½å¤±è´¥ (è¯·çœ‹ä¸‹æ–¹æ—¥å¿—)";
                document.getElementById('status').style.color = "#ef4444";
            } else {
                log("âœ… æ ¸å¿ƒåº“åŠ è½½æˆåŠŸï¼");
                log("ç­‰å¾…ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡...");
                document.getElementById('status').innerText = "âœ… å¼•æ“å°±ç»ªï¼Œè¯·ä¸Šä¼ å›¾ç‰‡";
                document.getElementById('status').style.color = "#4ade80";
                document.getElementById('fileInput').disabled = false;
            }
        };

        const fileInput = document.getElementById('fileInput');
        
        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const status = document.getElementById('status');
            status.innerText = "â³ æ­£åœ¨å¤„ç†... (é¦–æ¬¡è¿è¡Œéœ€ä¸‹è½½ 40MB æ¨¡å‹)";
            status.style.color = "#fbbf24";
            log("å¼€å§‹å¤„ç†å›¾ç‰‡: " + file.name);

            try {
                // è¿è¡Œ AI
                const blob = await imglyRemoveBackground(file, {
                    // æ˜¾å¼æŒ‡å®š unpkg è·¯å¾„ï¼Œç¡®ä¿ä¸èµ°å¼¯è·¯
                    publicPath: 'https://unpkg.com/@imgly/background-removal-data@1.0.4/dist/',
                    progress: (key, cur, total) => {
                        const pct = Math.round((cur / total) * 100);
                        if (key.includes('fetch')) {
                            status.innerText = `â¬‡ï¸ ä¸‹è½½æ¨¡å‹ä¸­... ${pct}%`;
                        } else {
                            status.innerText = `ğŸ§  AI è®¡ç®—ä¸­... ${pct}%`;
                        }
                    }
                });

                log("âœ… å¤„ç†å®Œæˆï¼ç”Ÿæˆå›¾ç‰‡é“¾æ¥...");
                const url = URL.createObjectURL(blob);
                document.getElementById('resImg').src = url;
                document.getElementById('result').style.display = 'block';
                window.dlUrl = url;
                status.innerText = "ğŸ‰ æå®šï¼";
                status.style.color = "#4ade80";

            } catch (err) {
                console.error(err);
                log("âŒ å¤„ç†æŠ¥é”™: " + err.message);
                status.innerText = "âŒ å‡ºé”™äº†ï¼Œè¯·æˆªå›¾ä¸‹æ–¹æ—¥å¿—";
                status.style.color = "#ef4444";
            }
        });

        function dl() {
            const a = document.createElement('a');
            a.href = window.dlUrl;
            a.download = 'æŠ å›¾ç»“æœ.png';
            a.click();
        }
    </script>
</body>
</html>
