<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæŠ å›¾ï¼ˆå¼ºå“¥Â·çŸ¥ä¹æé€Ÿæºï¼‰</title>
    <style>
        /* ä¿æŒä½ çš„è§†è§‰é£æ ¼ */
        body {
            font-family: sans-serif; background: radial-gradient(circle, #1e3a5f 0%, #020617 100%);
            color: #fff; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding: 40px;
        }
        h1 { margin-bottom: 40px; text-shadow: 0 0 10px #00d4ff; }
        
        .main-box {
            width: 100%; max-width: 800px; background: rgba(255,255,255,0.05);
            padding: 40px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }

        /* çŠ¶æ€ç¯ */
        .status-dot {
            display: inline-block; width: 10px; height: 10px; border-radius: 50%;
            background: #fbbf24; margin-right: 8px; box-shadow: 0 0 5px #fbbf24;
        }
        .status-text { color: #94a3b8; font-size: 14px; margin-bottom: 30px; }

        input[type="file"] { display: none; }
        
        .upload-btn {
            display: inline-block; padding: 15px 40px; border-radius: 50px;
            background: linear-gradient(90deg, #00d4ff, #0066ff);
            color: white; font-weight: bold; cursor: pointer;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3); transition: 0.3s;
            font-size: 18px; margin: 20px 0;
        }
        .upload-btn:hover { transform: scale(1.05); box-shadow: 0 0 30px rgba(0, 212, 255, 0.6); }

        img { max-width: 100%; border-radius: 10px; margin-top: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

    <h1>ğŸš€ AI æŠ å›¾ (æœ€ç»ˆæé€Ÿç‰ˆ)</h1>

    <div class="main-box">
        <div id="statusArea">
            <span class="status-dot" id="dot"></span>
            <span class="status-text" id="msg">æ­£åœ¨ä»çŸ¥ä¹èŠ‚ç‚¹åŠ è½½å¼•æ“...</span>
        </div>

        <label class="upload-btn" onclick="checkReady()">
            ğŸ“ ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡
            <input type="file" id="fileInput" accept="image/*" onchange="process(this.files[0])">
        </label>

        <div id="result" style="margin-top:20px;">
            <img id="resImg">
        </div>
    </div>

    <script src="https://unpkg.zhimg.com/@imgly/background-removal@1.0.4/dist/imgly-background-removal.min.js"></script>

    <script>
        // é…ç½®ï¼šæ¨¡å‹æ•°æ®èµ°é¥¿äº†ä¹ˆæº (é˜¿é‡Œæº)ï¼Œä»£ç èµ°çŸ¥ä¹æº
        // è¿™æ˜¯ä¸€ä¸ªâ€œåŒä¿é™©â€ç»„åˆ
        const DATA_URL = "https://npm.elemecdn.com/@imgly/background-removal-data@1.0.4/dist/";

        let isReady = false;

        // 1. æå…¶ç®€å•çš„æ£€æµ‹é€»è¾‘
        window.onload = function() {
            if (typeof imglyRemoveBackground !== 'undefined') {
                ready();
            } else {
                // å¦‚æœæ²¡åŠ è½½å‡ºæ¥ï¼Œå°è¯•ç­‰å¾… 2ç§’
                setTimeout(() => {
                    if (typeof imglyRemoveBackground !== 'undefined') ready();
                    else fail();
                }, 2000);
            }
        };

        function ready() {
            isReady = true;
            document.getElementById('dot').style.background = '#4ade80'; // å˜ç»¿
            document.getElementById('dot').style.boxShadow = '0 0 5px #4ade80';
            document.getElementById('msg').innerText = "âœ… å¼•æ“å·²å°±ç»ªï¼Œéšæ—¶å¯ä»¥å·¥ä½œ";
            document.getElementById('msg').style.color = "#4ade80";
        }

        function fail() {
            document.getElementById('dot').style.background = '#ff4d4d'; // å˜çº¢
            document.getElementById('msg').innerHTML = "âŒ åŠ è½½å¤±è´¥ã€‚è¯·å°è¯•ï¼š1.å…³é—­å¹¿å‘Šæ‹¦æˆªæ’ä»¶ 2.åˆ·æ–°é¡µé¢";
            document.getElementById('msg').style.color = "#ff4d4d";
        }

        function checkReady() {
            if(!isReady) alert("å¼•æ“è¿˜æ²¡åˆ°ï¼Œè¯·çœ‹ä¸Šæ–¹çš„çŠ¶æ€æ–‡å­—ï¼Œå¦‚æœæ˜¯çº¢è‰²è¯·åˆ·æ–°ï¼");
        }

        async function process(file) {
            if(!file) return;
            document.getElementById('msg').innerText = "â³ æ­£åœ¨æé€ŸæŠ å›¾ä¸­ (é¦–æ¬¡éœ€ä¸‹è½½æ¨¡å‹)...";
            document.getElementById('msg').style.color = "#fbbf24";
            document.getElementById('dot').style.background = "#fbbf24";

            try {
                const blob = await imglyRemoveBackground(file, {
                    publicPath: DATA_URL,
                    progress: (key, cur, total) => {
                         const pct = Math.round((cur/total)*100);
                         if(key.includes('fetch')) document.getElementById('msg').innerText = `â¬‡ï¸ ä¸‹è½½æ¨¡å‹: ${pct}%`;
                         else document.getElementById('msg').innerText = `ğŸ§  è®¡ç®—ä¸­: ${pct}%`;
                    }
                });
                
                const url = URL.createObjectURL(blob);
                document.getElementById('resImg').src = url;
                document.getElementById('msg').innerText = "ğŸ‰ å¤„ç†æˆåŠŸï¼é•¿æŒ‰å›¾ç‰‡å¯ä¿å­˜";
                document.getElementById('dot').style.background = "#4ade80"; // å˜ç»¿

            } catch (e) {
                alert("å‡ºé”™å•¦ï¼š" + e.message);
                document.getElementById('msg').innerText = "âŒ å¤„ç†å‡ºé”™ï¼Œè¯·é‡è¯•";
            }
        }
    </script>
</body>
</html>
